{
  boolean cacheEnabled=source.isDrawingCacheEnabled();
  source.setDrawingCacheEnabled(true);
  source.buildDrawingCache();
  Bitmap cache=source.getDrawingCache();
  if (cache == null)   return;
  int width=cache.getWidth();
  int height=cache.getHeight();
  float sx=(int)(width / 2.5f) / (float)width;
  float sy=(int)(height / 2.5f) / (float)height;
  Matrix m=new Matrix();
  m.setScale(sx,sy);
  CellLayout cell=((CellLayout)source);
  int x=cell.getLeftPadding();
  int y=cell.getTopPadding();
  width-=(x + cell.getRightPadding());
  height-=(y + cell.getBottomPadding());
  Bitmap bitmap=Bitmap.createBitmap(cache,x,y,width,height,m,true);
  ImageView preview=new ImageView(this);
  preview.setImageBitmap(bitmap);
  Drawable d=getResources().getDrawable(R.drawable.preview_popup);
  preview.setBackgroundDrawable(d);
  Rect r=new Rect();
  d.getPadding(r);
  int extraW=r.left + r.right;
  int extraH=r.top + r.bottom;
  PopupWindow p=new PopupWindow(preview,bitmap.getWidth() + extraW,bitmap.getHeight() + extraH);
  p.setWindowLayoutMode(ViewGroup.LayoutParams.WRAP_CONTENT,ViewGroup.LayoutParams.WRAP_CONTENT);
  p.setAnimationStyle(R.style.AnimationPreview);
  p.showAsDropDown(anchor,0,0);
  source.destroyDrawingCache();
  if (!cacheEnabled)   source.setDrawingCacheEnabled(cacheEnabled);
  anchor.setTag(p);
  anchor.setTag(R.id.workspace,preview);
  anchor.setTag(R.id.icon,bitmap);
}
