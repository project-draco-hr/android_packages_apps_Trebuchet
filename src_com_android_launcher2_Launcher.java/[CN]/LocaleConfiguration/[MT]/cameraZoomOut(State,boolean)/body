{
  final Resources res=getResources();
  final boolean toAllApps=(toState == State.ALL_APPS);
  final int duration=toAllApps ? res.getInteger(R.integer.config_allAppsZoomInTime) : res.getInteger(R.integer.config_customizeZoomInTime);
  final float scale=toAllApps ? (float)res.getInteger(R.integer.config_allAppsZoomScaleFactor) : (float)res.getInteger(R.integer.config_customizeZoomScaleFactor);
  final View toView=toAllApps ? (View)mAllAppsGrid : mHomeCustomizationDrawer;
  setPivotsForZoom(toView,toState,scale);
  if (toAllApps) {
    mWorkspace.shrink(ShrinkState.BOTTOM_HIDDEN,animated);
  }
 else {
    mWorkspace.shrink(ShrinkState.TOP,animated);
  }
  if (animated) {
    ValueAnimator scaleAnim=ObjectAnimator.ofPropertyValuesHolder(toView,PropertyValuesHolder.ofFloat("scaleX",scale,1.0f),PropertyValuesHolder.ofFloat("scaleY",scale,1.0f));
    scaleAnim.setDuration(duration);
    if (toAllApps) {
      toView.setAlpha(0f);
      ObjectAnimator alphaAnim=ObjectAnimator.ofPropertyValuesHolder(toView,PropertyValuesHolder.ofFloat("alpha",1.0f));
      alphaAnim.setInterpolator(new DecelerateInterpolator(1.0f));
      alphaAnim.setDuration(duration);
      alphaAnim.start();
    }
    scaleAnim.setInterpolator(new Workspace.ZoomOutInterpolator());
    if (mWorkspace.getWidth() < mWorkspace.getHeight()) {
      toView.setLayerType(View.LAYER_TYPE_HARDWARE,null);
    }
    scaleAnim.addListener(new AnimatorListenerAdapter(){
      @Override public void onAnimationStart(      Animator animation){
        toView.setTranslationX(0.0f);
        toView.setTranslationY(0.0f);
        toView.setVisibility(View.VISIBLE);
        if (!toAllApps) {
          toView.setAlpha(1.0f);
        }
      }
      @Override public void onAnimationEnd(      Animator animation){
        toView.setLayerType(View.LAYER_TYPE_NONE,null);
        toView.setScaleX(1.0f);
        toView.setScaleY(1.0f);
      }
    }
);
    AnimatorSet toolbarHideAnim=new AnimatorSet();
    AnimatorSet toolbarShowAnim=new AnimatorSet();
    hideAndShowToolbarButtons(toState,toolbarShowAnim,toolbarHideAnim);
    final int startDelay=0;
    if (mStateAnimation != null)     mStateAnimation.cancel();
    mStateAnimation=new AnimatorSet();
    mStateAnimation.playTogether(scaleAnim,toolbarHideAnim);
    mStateAnimation.play(scaleAnim).after(startDelay);
    final int fadeInTime=res.getInteger(R.integer.config_toolbarButtonFadeInTime);
    mStateAnimation.play(toolbarShowAnim).after(duration + startDelay - fadeInTime);
    mStateAnimation.start();
  }
 else {
    toView.setTranslationX(0.0f);
    toView.setTranslationY(0.0f);
    toView.setScaleX(1.0f);
    toView.setScaleY(1.0f);
    toView.setVisibility(View.VISIBLE);
    hideAndShowToolbarButtons(toState,null,null);
  }
}
