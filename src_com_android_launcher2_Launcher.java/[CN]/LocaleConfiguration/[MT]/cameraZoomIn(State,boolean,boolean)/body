{
  Resources res=getResources();
  final boolean fromAllApps=(fromState == State.ALL_APPS) || (fromState == State.APPS_CUSTOMIZE);
  int duration=fromAllApps ? res.getInteger(R.integer.config_appsCustomizeZoomOutTime) : res.getInteger(R.integer.config_customizeZoomOutTime);
  final float scaleFactor=fromAllApps ? (float)res.getInteger(R.integer.config_appsCustomizeZoomScaleFactor) : (float)res.getInteger(R.integer.config_customizeZoomScaleFactor);
  View tmpView;
  if (fromAllApps) {
    tmpView=(LauncherApplication.isScreenXLarge()) ? (View)mAllAppsGrid : mAppsCustomizeTabHost;
  }
 else {
    tmpView=mHomeCustomizationDrawer;
  }
  final View fromView=tmpView;
  if (LauncherApplication.isScreenXLarge()) {
    mCustomizePagedView.endChoiceMode();
    mAllAppsPagedView.endChoiceMode();
  }
  setPivotsForZoom(fromView,fromState,scaleFactor);
  if (!springLoaded) {
    mWorkspace.unshrink(animated);
  }
  if (animated) {
    if (mStateAnimation != null)     mStateAnimation.cancel();
    mStateAnimation=new AnimatorSet();
    final float oldScaleX=fromView.getScaleX();
    final float oldScaleY=fromView.getScaleY();
    ValueAnimator scaleAnim=ValueAnimator.ofFloat(0f,1f).setDuration(duration);
    scaleAnim.setInterpolator(new Workspace.ZoomInInterpolator());
    scaleAnim.addUpdateListener(new LauncherAnimatorUpdateListener(){
      public void onAnimationUpdate(      float a,      float b){
        ((View)fromView.getParent()).fastInvalidate();
        fromView.setFastScaleX(a * oldScaleX + b * scaleFactor);
        fromView.setFastScaleY(a * oldScaleY + b * scaleFactor);
      }
    }
);
    final ValueAnimator alphaAnim=ValueAnimator.ofFloat(0f,1f);
    alphaAnim.setDuration(res.getInteger(R.integer.config_appsCustomizeFadeOutTime));
    alphaAnim.setInterpolator(new DecelerateInterpolator(1.5f));
    alphaAnim.addUpdateListener(new LauncherAnimatorUpdateListener(){
      public void onAnimationUpdate(      float a,      float b){
        fromView.setFastAlpha(a * 1f + b * 0f);
      }
    }
);
    if (fromView instanceof LauncherTransitionable) {
      ((LauncherTransitionable)fromView).onLauncherTransitionStart(alphaAnim);
    }
    alphaAnim.addListener(new AnimatorListenerAdapter(){
      @Override public void onAnimationEnd(      Animator animation){
        fromView.setVisibility(View.GONE);
        if (fromView instanceof LauncherTransitionable) {
          ((LauncherTransitionable)fromView).onLauncherTransitionEnd(alphaAnim);
        }
      }
    }
);
    AnimatorSet toolbarHideAnim=new AnimatorSet();
    AnimatorSet toolbarShowAnim=new AnimatorSet();
    if (!springLoaded) {
      hideAndShowToolbarButtons(State.WORKSPACE,toolbarShowAnim,toolbarHideAnim);
    }
    mStateAnimation.playTogether(scaleAnim,toolbarHideAnim,alphaAnim);
    final int fadeInTime=res.getInteger(R.integer.config_toolbarButtonFadeInTime);
    final int unshrinkTime=res.getInteger(R.integer.config_workspaceUnshrinkTime);
    mStateAnimation.play(toolbarShowAnim).after(unshrinkTime - fadeInTime);
    mStateAnimation.start();
  }
 else {
    fromView.setVisibility(View.GONE);
    if (fromView instanceof LauncherTransitionable) {
      ((LauncherTransitionable)fromView).onLauncherTransitionStart(null);
      ((LauncherTransitionable)fromView).onLauncherTransitionEnd(null);
    }
    if (!springLoaded) {
      hideAndShowToolbarButtons(State.WORKSPACE,null,null);
    }
  }
}
