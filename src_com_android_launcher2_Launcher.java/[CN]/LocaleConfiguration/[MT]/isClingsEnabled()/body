{
  if (ActivityManager.isRunningInTestHarness())   return false;
  boolean supportsLimitedUsers=android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.JELLY_BEAN_MR2;
  Account[] accounts=AccountManager.get(this).getAccounts();
  if (supportsLimitedUsers && accounts.length == 0) {
    UserManager um=(UserManager)getSystemService(Context.USER_SERVICE);
    Bundle restrictions=um.getUserRestrictions();
    if (restrictions.getBoolean(UserManager.DISALLOW_MODIFY_ACCOUNTS,false)) {
      return false;
    }
  }
  return true;
}
