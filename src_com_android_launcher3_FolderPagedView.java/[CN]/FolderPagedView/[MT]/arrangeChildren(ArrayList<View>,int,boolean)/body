{
  ArrayList<CellLayout> pages=new ArrayList<CellLayout>();
  for (int i=0; i < getChildCount(); i++) {
    CellLayout page=(CellLayout)getChildAt(i);
    page.removeAllViews();
    pages.add(page);
  }
  setupContentDimensions(itemCount);
  Iterator<CellLayout> pageItr=pages.iterator();
  CellLayout currentPage=null;
  int position=0;
  int newX, newY, rank;
  boolean isSorted=mIsSorted;
  ViewComparator comparator=new ViewComparator();
  View lastView=null;
  rank=0;
  for (int i=0; i < itemCount; i++) {
    View v=list.size() > i ? list.get(i) : null;
    if (currentPage == null || position >= mMaxItemsPerPage) {
      if (pageItr.hasNext()) {
        currentPage=pageItr.next();
      }
 else {
        currentPage=createAndAddNewPage();
      }
      position=0;
    }
    if (v != null) {
      if (lastView != null) {
        isSorted&=comparator.compare(lastView,v) <= 0;
      }
      CellLayout.LayoutParams lp=(CellLayout.LayoutParams)v.getLayoutParams();
      newX=position % mGridCountX;
      newY=position / mGridCountX;
      ItemInfo info=(ItemInfo)v.getTag();
      if (info.cellX != newX || info.cellY != newY || info.rank != rank) {
        info.cellX=newX;
        info.cellY=newY;
        info.rank=rank;
        if (saveChanges) {
          LauncherModel.addOrMoveItemInDatabase(getContext(),info,mFolder.mInfo.id,0,info.cellX,info.cellY);
        }
      }
      lp.cellX=info.cellX;
      lp.cellY=info.cellY;
      currentPage.addViewToCellLayout(v,-1,mFolder.mLauncher.getViewIdForItem(info),lp,true);
    }
    lastView=v;
    rank++;
    position++;
  }
  boolean removed=false;
  while (pageItr.hasNext()) {
    removeView(pageItr.next());
    removed=true;
  }
  if (removed) {
    setCurrentPage(0);
  }
  setIsSorted(isSorted,saveChanges);
  if (getPageCount() > 1) {
    mPageIndicator.setVisibility(View.VISIBLE);
    mSortButton.setVisibility(View.VISIBLE);
    mFolder.mFolderName.setGravity(rtlLayout ? Gravity.RIGHT : Gravity.LEFT);
    setEnableOverscroll(true);
  }
 else {
    mPageIndicator.setVisibility(View.GONE);
    mSortButton.setVisibility(View.GONE);
    mFolder.mFolderName.setGravity(Gravity.CENTER_HORIZONTAL);
    setEnableOverscroll(false);
  }
}
