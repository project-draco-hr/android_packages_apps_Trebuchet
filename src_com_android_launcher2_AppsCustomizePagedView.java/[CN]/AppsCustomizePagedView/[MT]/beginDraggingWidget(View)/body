{
  Log.d(TAG,"begin dragging widget, view: " + v);
  mDraggingWidget=true;
  ImageView image=(ImageView)v.findViewById(R.id.widget_preview);
  PendingAddItemInfo createItemInfo=(PendingAddItemInfo)v.getTag();
  if (image.getDrawable() == null) {
    mDraggingWidget=false;
    return false;
  }
  if (mCreateWidgetInfo == null) {
    return false;
  }
  Bitmap preview;
  Bitmap outline;
  float scale=1f;
  if (createItemInfo instanceof PendingAddWidgetInfo) {
    PendingAddWidgetInfo createWidgetInfo=mCreateWidgetInfo;
    createItemInfo=createWidgetInfo;
    int spanX=createItemInfo.spanX;
    int spanY=createItemInfo.spanY;
    int[] size=mLauncher.getWorkspace().estimateItemSize(spanX,spanY,createWidgetInfo,true);
    FastBitmapDrawable previewDrawable=(FastBitmapDrawable)image.getDrawable();
    float minScale=1.25f;
    int minWidth, minHeight;
    minWidth=Math.max((int)(previewDrawable.getIntrinsicWidth() * minScale),size[0]);
    minHeight=Math.max((int)(previewDrawable.getIntrinsicHeight() * minScale),size[1]);
    preview=getWidgetPreview(createWidgetInfo.componentName,createWidgetInfo.previewImage,createWidgetInfo.icon,spanX,spanY,minWidth,minHeight);
    float[] mv=new float[9];
    Matrix m=new Matrix();
    m.setRectToRect(new RectF(0f,0f,(float)preview.getWidth(),(float)preview.getHeight()),new RectF(0f,0f,(float)previewDrawable.getIntrinsicWidth(),(float)previewDrawable.getIntrinsicHeight()),Matrix.ScaleToFit.START);
    m.getValues(mv);
    scale=(float)mv[0];
  }
 else {
    preview=Bitmap.createBitmap(mWidgetPreviewIconPaddedDimension,mWidgetPreviewIconPaddedDimension,Bitmap.Config.ARGB_8888);
    Drawable d=image.getDrawable();
    mCanvas.setBitmap(preview);
    mCanvas.save();
    mCanvas.translate((mWidgetPreviewIconPaddedDimension - d.getIntrinsicWidth()) / 2,(mWidgetPreviewIconPaddedDimension - d.getIntrinsicHeight()) / 2);
    d.draw(mCanvas);
    mCanvas.restore();
    mCanvas.setBitmap(null);
    createItemInfo.spanX=createItemInfo.spanY=1;
  }
  Paint alphaClipPaint=null;
  if (createItemInfo instanceof PendingAddWidgetInfo) {
    if (((PendingAddWidgetInfo)createItemInfo).previewImage != 0) {
      MaskFilter alphaClipTable=TableMaskFilter.CreateClipTable(0,255);
      alphaClipPaint=new Paint();
      alphaClipPaint.setMaskFilter(alphaClipTable);
    }
  }
  outline=Bitmap.createScaledBitmap(preview,preview.getWidth(),preview.getHeight(),false);
  alphaClipPaint=null;
  mLauncher.lockScreenOrientation();
  mLauncher.getWorkspace().onDragStartedWithItem(createItemInfo,outline,alphaClipPaint);
  mDragController.startDrag(image,preview,this,createItemInfo,DragController.DRAG_ACTION_COPY,null,scale);
  outline.recycle();
  preview.recycle();
  return true;
}
