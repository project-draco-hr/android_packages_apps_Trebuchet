{
  mDraggingWidget=true;
  ImageView image=(ImageView)v.findViewById(R.id.widget_preview);
  PendingAddItemInfo createItemInfo=(PendingAddItemInfo)v.getTag();
  if (image.getDrawable() == null) {
    mDraggingWidget=false;
    return false;
  }
  Bitmap preview;
  Bitmap outline;
  float scale=1f;
  if (createItemInfo instanceof PendingAddWidgetInfo) {
    if (mCreateWidgetInfo == null) {
      return false;
    }
    PendingAddWidgetInfo createWidgetInfo=mCreateWidgetInfo;
    createItemInfo=createWidgetInfo;
    int spanX=createItemInfo.spanX;
    int spanY=createItemInfo.spanY;
    int[] size=mLauncher.getWorkspace().estimateItemSize(spanX,spanY,createWidgetInfo,true);
    FastBitmapDrawable previewDrawable=(FastBitmapDrawable)image.getDrawable();
    float minScale=1.25f;
    int maxWidth, maxHeight;
    maxWidth=Math.min((int)(previewDrawable.getIntrinsicWidth() * minScale),size[0]);
    maxHeight=Math.min((int)(previewDrawable.getIntrinsicHeight() * minScale),size[1]);
    preview=getWidgetPreview(createWidgetInfo.componentName,createWidgetInfo.previewImage,createWidgetInfo.icon,spanX,spanY,maxWidth,maxHeight);
    float[] mv=new float[9];
    Matrix m=new Matrix();
    m.setRectToRect(new RectF(0f,0f,(float)preview.getWidth(),(float)preview.getHeight()),new RectF(0f,0f,(float)previewDrawable.getIntrinsicWidth(),(float)previewDrawable.getIntrinsicHeight()),Matrix.ScaleToFit.START);
    m.getValues(mv);
    scale=(float)mv[0];
  }
 else {
    PendingAddShortcutInfo createShortcutInfo=(PendingAddShortcutInfo)v.getTag();
    Drawable icon=mIconCache.getFullResIcon(createShortcutInfo.shortcutActivityInfo);
    preview=Bitmap.createBitmap(icon.getIntrinsicWidth(),icon.getIntrinsicHeight(),Bitmap.Config.ARGB_8888);
    mCanvas.setBitmap(preview);
    mCanvas.save();
    renderDrawableToBitmap(icon,preview,0,0,icon.getIntrinsicWidth(),icon.getIntrinsicHeight());
    mCanvas.restore();
    mCanvas.setBitmap(null);
    createItemInfo.spanX=createItemInfo.spanY=1;
  }
  Paint alphaClipPaint=null;
  if (createItemInfo instanceof PendingAddWidgetInfo) {
    if (((PendingAddWidgetInfo)createItemInfo).previewImage != 0) {
      MaskFilter alphaClipTable=TableMaskFilter.CreateClipTable(0,255);
      alphaClipPaint=new Paint();
      alphaClipPaint.setMaskFilter(alphaClipTable);
    }
  }
  outline=Bitmap.createScaledBitmap(preview,preview.getWidth(),preview.getHeight(),false);
  alphaClipPaint=null;
  mLauncher.lockScreenOrientation();
  mLauncher.getWorkspace().onDragStartedWithItem(createItemInfo,outline,alphaClipPaint);
  mDragController.startDrag(image,preview,this,createItemInfo,DragController.DRAG_ACTION_COPY,null,scale);
  outline.recycle();
  preview.recycle();
  return true;
}
