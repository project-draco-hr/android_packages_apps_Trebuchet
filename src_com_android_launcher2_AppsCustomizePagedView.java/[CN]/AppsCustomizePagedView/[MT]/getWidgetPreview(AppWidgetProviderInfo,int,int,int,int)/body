{
  String packageName=info.provider.getPackageName();
  Drawable drawable=null;
  Bitmap preview=null;
  if (info.previewImage != 0) {
    drawable=mPackageManager.getDrawable(packageName,info.previewImage,null);
    if (drawable == null) {
      Log.w(LOG_TAG,"Can't load icon drawable 0x" + Integer.toHexString(info.icon) + " for provider: "+ info.provider);
    }
 else {
      int imageWidth=drawable.getIntrinsicWidth();
      int imageHeight=drawable.getIntrinsicHeight();
      int bitmapWidth=imageWidth;
      int bitmapHeight=imageHeight;
      if (imageWidth > imageHeight) {
        bitmapWidth=cellWidth;
        bitmapHeight=(int)(imageHeight * ((float)bitmapWidth / imageWidth));
      }
 else {
        bitmapHeight=cellHeight;
        bitmapWidth=(int)(imageWidth * ((float)bitmapHeight / imageHeight));
      }
      preview=Bitmap.createBitmap(bitmapWidth,bitmapHeight,Config.ARGB_8888);
      renderDrawableToBitmap(drawable,preview,0,0,bitmapWidth,bitmapHeight);
    }
  }
  if (drawable == null) {
    Resources resources=mLauncher.getResources();
    int targetWidth=mWidgetSpacingLayout.estimateCellWidth(cellHSpan);
    int targetHeight=mWidgetSpacingLayout.estimateCellHeight(cellVSpan);
    int bitmapWidth=targetWidth;
    int bitmapHeight=targetHeight;
    int offset=(int)(mAppIconSize * sWidgetPreviewIconPaddingPercentage);
    float iconScale=1f;
    if (cellHSpan == cellVSpan) {
      if (cellHSpan <= 1) {
        bitmapWidth=bitmapHeight=mAppIconSize + 2 * offset;
      }
 else {
        bitmapWidth=bitmapHeight=mAppIconSize + 4 * offset;
      }
    }
 else {
      if (targetWidth > targetHeight) {
        bitmapWidth=Math.min(targetWidth,cellWidth);
        bitmapHeight=(int)(targetHeight * ((float)bitmapWidth / targetWidth));
        iconScale=Math.min((float)bitmapHeight / (mAppIconSize + 2 * offset),1f);
      }
 else {
        bitmapHeight=Math.min(targetHeight,cellHeight);
        bitmapWidth=(int)(targetWidth * ((float)bitmapHeight / targetHeight));
        iconScale=Math.min((float)bitmapWidth / (mAppIconSize + 2 * offset),1f);
      }
    }
    preview=Bitmap.createBitmap(bitmapWidth,bitmapHeight,Config.ARGB_8888);
    renderDrawableToBitmap(mDefaultWidgetBackground,preview,0,0,bitmapWidth,bitmapWidth);
    try {
      Drawable icon=null;
      if (info.icon > 0)       icon=mPackageManager.getDrawable(packageName,info.icon,null);
      if (icon == null)       icon=resources.getDrawable(R.drawable.ic_launcher_application);
      renderDrawableToBitmap(icon,preview,(int)(offset * iconScale),(int)(offset * iconScale),(int)(mAppIconSize * iconScale),(int)(mAppIconSize * iconScale));
    }
 catch (    Resources.NotFoundException e) {
    }
  }
  return preview;
}
