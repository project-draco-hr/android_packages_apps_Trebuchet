{
  ActivityInfo activityInfo=ri.activityInfo;
  XmlResourceParser parser=null;
  ComponentName component=new ComponentName(ri.activityInfo.packageName,ri.activityInfo.name);
  try {
    parser=activityInfo.loadXmlMetaData(mPackageManager,WallpaperManager.WALLPAPER_PREVIEW_META_DATA);
    if (parser == null) {
      Slog.w(LOG_TAG,"No " + WallpaperManager.WALLPAPER_PREVIEW_META_DATA + " meta-data for "+ "wallpaper provider '"+ component+ '\'');
      return null;
    }
    AttributeSet attrs=Xml.asAttributeSet(parser);
    int type;
    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT && type != XmlPullParser.START_TAG) {
    }
    String nodeName=parser.getName();
    if (!"wallpaper-preview".equals(nodeName)) {
      Slog.w(LOG_TAG,"Meta-data does not start with wallpaper-preview tag for " + "wallpaper provider '" + component + '\'');
      return null;
    }
    Resources res=mPackageManager.getResourcesForApplication(activityInfo.applicationInfo);
    TypedArray sa=res.obtainAttributes(attrs,com.android.internal.R.styleable.WallpaperPreviewInfo);
    TypedValue value=sa.peekValue(com.android.internal.R.styleable.WallpaperPreviewInfo_staticWallpaperPreview);
    if (value == null)     return null;
    return res.getDrawable(value.resourceId);
  }
 catch (  Exception e) {
    Slog.w(LOG_TAG,"XML parsing failed for wallpaper provider '" + component + '\'',e);
    return null;
  }
 finally {
    if (parser != null)     parser.close();
  }
}
