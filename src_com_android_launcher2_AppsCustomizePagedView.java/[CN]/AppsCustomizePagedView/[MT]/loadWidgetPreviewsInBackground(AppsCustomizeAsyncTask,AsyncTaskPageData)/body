{
  if (task != null) {
    task.syncThreadPriority();
  }
  ArrayList<Object> items=data.items;
  ArrayList<Bitmap> images=data.generatedImages;
  int count=items.size();
  for (int i=0; i < count; ++i) {
    if (task != null) {
      if (task.isCancelled())       break;
      task.syncThreadPriority();
    }
    Object rawInfo=items.get(i);
    if (rawInfo instanceof AppWidgetProviderInfo) {
      AppWidgetProviderInfo info=(AppWidgetProviderInfo)rawInfo;
      int[] cellSpans=Launcher.getSpanForWidget(mLauncher,info);
      int maxWidth=Math.min(data.maxImageWidth,mWidgetSpacingLayout.estimateCellWidth(cellSpans[0]));
      int maxHeight=Math.min(data.maxImageHeight,mWidgetSpacingLayout.estimateCellHeight(cellSpans[1]));
      Bitmap b=getWidgetPreview(info.provider,info.previewImage,info.icon,cellSpans[0],cellSpans[1],maxWidth,maxHeight);
      images.add(b);
    }
 else     if (rawInfo instanceof ResolveInfo) {
      ResolveInfo info=(ResolveInfo)rawInfo;
      images.add(getShortcutPreview(info));
    }
  }
}
