{
  mWidgets.clear();
  List<AppWidgetProviderInfo> widgets=AppWidgetManager.getInstance(mLauncher).getInstalledProviders();
  Intent shortcutsIntent=new Intent(Intent.ACTION_CREATE_SHORTCUT);
  List<ResolveInfo> shortcuts=mPackageManager.queryIntentActivities(shortcutsIntent,0);
  for (  AppWidgetProviderInfo widget : widgets) {
    widget.label=widget.label.trim();
    if (widget.minWidth > 0 && widget.minHeight > 0) {
      int[] spanXY=Launcher.getSpanForWidget(mLauncher,widget);
      int[] minSpanXY=Launcher.getMinSpanForWidget(mLauncher,widget);
      int minSpanX=Math.min(spanXY[0],minSpanXY[0]);
      int minSpanY=Math.min(spanXY[1],minSpanXY[1]);
      if (minSpanX <= LauncherModel.getCellCountX() && minSpanY <= LauncherModel.getCellCountY()) {
        mWidgets.add(widget);
      }
 else {
        Log.e(TAG,"Widget " + widget.provider + " can not fit on this device ("+ widget.minWidth+ ", "+ widget.minHeight+ ")");
      }
    }
 else {
      Log.e(TAG,"Widget " + widget.provider + " has invalid dimensions ("+ widget.minWidth+ ", "+ widget.minHeight+ ")");
    }
  }
  mWidgets.addAll(shortcuts);
  Collections.sort(mWidgets,new LauncherModel.WidgetAndShortcutNameComparator(mPackageManager));
  updatePageCounts();
  invalidateOnDataChange();
}
