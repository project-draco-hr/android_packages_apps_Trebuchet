{
  if (VERBOSE)   Log.v(TAG,"onBackup");
  Journal in=readJournal(oldState);
  if (!launcherIsReady()) {
    writeJournal(newState,in);
    return;
  }
  Log.v(TAG,"lastBackupTime = " + in.t);
  mKeys.clear();
  applyJournal(in);
  long newBackupTime=System.currentTimeMillis();
  try {
    backupFavorites(data);
    backupScreens(data);
    backupIcons(data);
    backupWidgets(data);
    HashSet<String> validKeys=new HashSet<String>();
    for (    Key key : mKeys) {
      validKeys.add(keyToBackupKey(key));
    }
    mExistingKeys.removeAll(validKeys);
    for (    String deleted : mExistingKeys) {
      if (VERBOSE)       Log.v(TAG,"dropping deleted item " + deleted);
      data.writeEntityHeader(deleted,-1);
    }
    mExistingKeys.clear();
    mLastBackupRestoreTime=newBackupTime;
    Journal state=getCurrentStateJournal();
    writeRowToBackup(JOURNAL_KEY,state,data);
  }
 catch (  IOException e) {
    Log.e(TAG,"launcher backup has failed",e);
  }
  writeNewStateDescription(newState);
}
