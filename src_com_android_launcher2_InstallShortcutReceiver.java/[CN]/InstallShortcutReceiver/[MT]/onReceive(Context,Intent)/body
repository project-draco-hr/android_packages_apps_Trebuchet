{
  if (!ACTION_INSTALL_SHORTCUT.equals(data.getAction())) {
    return;
  }
  String spKey=LauncherApplication.getSharedPreferencesKey();
  SharedPreferences sp=context.getSharedPreferences(spKey,Context.MODE_PRIVATE);
  final Intent intent=data.getParcelableExtra(Intent.EXTRA_SHORTCUT_INTENT);
  if (intent == null) {
    return;
  }
  String name=data.getStringExtra(Intent.EXTRA_SHORTCUT_NAME);
  if (name == null) {
    try {
      PackageManager pm=context.getPackageManager();
      ActivityInfo info=pm.getActivityInfo(intent.getComponent(),0);
      name=info.loadLabel(pm).toString();
    }
 catch (    PackageManager.NameNotFoundException nnfe) {
      return;
    }
  }
  LauncherApplication app=(LauncherApplication)context.getApplicationContext();
  final int[] result={INSTALL_SHORTCUT_SUCCESSFUL};
  boolean found=false;
synchronized (app) {
    final ArrayList<ItemInfo> items=LauncherModel.getItemsInLocalCoordinates(context);
    final boolean exists=LauncherModel.shortcutExists(context,name,intent);
    final int screen=Launcher.DEFAULT_SCREEN;
    for (int i=0; i < (2 * Launcher.SCREEN_COUNT) + 1 && !found; ++i) {
      int si=screen + (int)((i / 2f) + 0.5f) * ((i % 2 == 1) ? 1 : -1);
      if (0 <= si && si < Launcher.SCREEN_COUNT) {
        found=installShortcut(context,data,items,name,intent,si,exists,sp,result);
      }
    }
  }
  if (!found) {
    if (result[0] == INSTALL_SHORTCUT_NO_SPACE) {
      Toast.makeText(context,context.getString(R.string.completely_out_of_space),Toast.LENGTH_SHORT).show();
    }
 else     if (result[0] == INSTALL_SHORTCUT_IS_DUPLICATE) {
      Toast.makeText(context,context.getString(R.string.shortcut_duplicate,name),Toast.LENGTH_SHORT).show();
    }
  }
}
