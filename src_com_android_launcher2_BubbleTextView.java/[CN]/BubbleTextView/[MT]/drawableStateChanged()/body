{
  if (isPressed()) {
    if (!mDidInvalidateForPressedState) {
      invalidatePressedOrFocusedBackground();
    }
  }
 else {
    final boolean backgroundEmptyBefore=mPressedOrFocusedBackground == null;
    if (!mStayPressed) {
      mPressedOrFocusedBackground=null;
    }
    if (isFocused()) {
      mPressedOrFocusedBackground=createGlowingOutline(mTempCanvas,mFocusedGlowColor,mFocusedOutlineColor);
      mStayPressed=false;
      invalidatePressedOrFocusedBackground();
    }
    final boolean backgroundEmptyNow=mPressedOrFocusedBackground == null;
    if (!backgroundEmptyBefore && backgroundEmptyNow) {
      invalidatePressedOrFocusedBackground();
    }
  }
  Drawable d=mBackground;
  if (d != null && d.isStateful()) {
    d.setState(getDrawableState());
  }
  super.drawableStateChanged();
}
