{
  if (clipAlpha) {
    int[] srcBuffer=new int[srcDst.getWidth() * srcDst.getHeight()];
    srcDst.getPixels(srcBuffer,0,srcDst.getWidth(),0,0,srcDst.getWidth(),srcDst.getHeight());
    for (int i=0; i < srcBuffer.length; i++) {
      final int alpha=srcBuffer[i] >>> 24;
      if (alpha < 188) {
        srcBuffer[i]=0;
      }
    }
    srcDst.setPixels(srcBuffer,0,srcDst.getWidth(),0,0,srcDst.getWidth(),srcDst.getHeight());
  }
  Bitmap glowShape=srcDst.extractAlpha();
  BlurMaskFilter outerBlurMaskFilter;
switch (thickness) {
case EXTRA_THICK:
    outerBlurMaskFilter=mExtraThickOuterBlurMaskFilter;
  break;
case THICK:
outerBlurMaskFilter=mThickOuterBlurMaskFilter;
break;
case MEDIUM:
outerBlurMaskFilter=mMediumOuterBlurMaskFilter;
break;
default :
throw new RuntimeException("Invalid blur thickness");
}
mBlurPaint.setMaskFilter(outerBlurMaskFilter);
int[] outerBlurOffset=new int[2];
Bitmap thickOuterBlur=glowShape.extractAlpha(mBlurPaint,outerBlurOffset);
if (thickness == EXTRA_THICK) {
mBlurPaint.setMaskFilter(mMediumOuterBlurMaskFilter);
}
 else {
mBlurPaint.setMaskFilter(mThinOuterBlurMaskFilter);
}
int[] brightOutlineOffset=new int[2];
Bitmap brightOutline=glowShape.extractAlpha(mBlurPaint,brightOutlineOffset);
srcDstCanvas.setBitmap(glowShape);
srcDstCanvas.drawColor(0xFF000000,PorterDuff.Mode.SRC_OUT);
BlurMaskFilter innerBlurMaskFilter;
switch (thickness) {
case EXTRA_THICK:
innerBlurMaskFilter=mExtraThickInnerBlurMaskFilter;
break;
case THICK:
innerBlurMaskFilter=mThickInnerBlurMaskFilter;
break;
case MEDIUM:
innerBlurMaskFilter=mMediumInnerBlurMaskFilter;
break;
default :
throw new RuntimeException("Invalid blur thickness");
}
mBlurPaint.setMaskFilter(innerBlurMaskFilter);
int[] thickInnerBlurOffset=new int[2];
Bitmap thickInnerBlur=glowShape.extractAlpha(mBlurPaint,thickInnerBlurOffset);
srcDstCanvas.setBitmap(thickInnerBlur);
srcDstCanvas.drawBitmap(glowShape,-thickInnerBlurOffset[0],-thickInnerBlurOffset[1],mErasePaint);
srcDstCanvas.drawRect(0,0,-thickInnerBlurOffset[0],thickInnerBlur.getHeight(),mErasePaint);
srcDstCanvas.drawRect(0,0,thickInnerBlur.getWidth(),-thickInnerBlurOffset[1],mErasePaint);
srcDstCanvas.setBitmap(srcDst);
srcDstCanvas.drawColor(0,PorterDuff.Mode.CLEAR);
mHolographicPaint.setColor(color);
srcDstCanvas.drawBitmap(thickInnerBlur,thickInnerBlurOffset[0],thickInnerBlurOffset[1],mHolographicPaint);
srcDstCanvas.drawBitmap(thickOuterBlur,outerBlurOffset[0],outerBlurOffset[1],mHolographicPaint);
mHolographicPaint.setColor(outlineColor);
srcDstCanvas.drawBitmap(brightOutline,brightOutlineOffset[0],brightOutlineOffset[1],mHolographicPaint);
srcDstCanvas.setBitmap(null);
brightOutline.recycle();
thickOuterBlur.recycle();
thickInnerBlur.recycle();
glowShape.recycle();
}
