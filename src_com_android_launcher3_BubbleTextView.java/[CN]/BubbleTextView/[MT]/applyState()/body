{
  if (getTag() instanceof ShortcutInfo) {
    ShortcutInfo info=(ShortcutInfo)getTag();
    final int state=info.getState();
    final int progressLevel;
    if (DEBUG)     Log.d(TAG,"applying icon state: " + state);
switch (state) {
case ShortcutInfo.PACKAGE_STATE_DEFAULT:
      progressLevel=100;
    break;
case ShortcutInfo.PACKAGE_STATE_INSTALLING:
  setText(R.string.package_state_installing);
progressLevel=info.getProgress();
break;
case ShortcutInfo.PACKAGE_STATE_ERROR:
case ShortcutInfo.PACKAGE_STATE_UNKNOWN:
default :
progressLevel=0;
setText(R.string.package_state_unknown);
break;
}
Drawable[] drawables=getCompoundDrawables();
Drawable top=drawables[1];
if (top != null) {
final PreloadIconDrawable preloadDrawable;
if (top instanceof PreloadIconDrawable) {
preloadDrawable=(PreloadIconDrawable)top;
}
 else {
preloadDrawable=new PreloadIconDrawable(top,getResources());
setCompoundDrawables(drawables[0],preloadDrawable,drawables[2],drawables[3]);
}
preloadDrawable.setLevel(progressLevel);
if (state == ShortcutInfo.PACKAGE_STATE_DEFAULT) {
preloadDrawable.maybePerformFinishedAnimation();
}
}
}
}
