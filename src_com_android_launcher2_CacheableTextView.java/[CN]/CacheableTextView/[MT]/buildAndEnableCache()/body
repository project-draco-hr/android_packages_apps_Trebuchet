{
  if (getLayout() == null) {
    mWaitingToGenerateCache=true;
    return;
  }
  final Layout layout=getLayout();
  final int left=getCompoundPaddingLeft();
  final int top=getExtendedPaddingTop();
  final float prevAlpha=getAlpha();
  int vPadding=getVerticalPadding();
  int hPadding=getHorizontalPadding();
  mTextCacheLeft=layout.getLineLeft(0) - hPadding;
  mTextCacheTop=top + layout.getLineTop(0) - mPaddingV - vPadding;
  mRectLeft=mScrollX + getLeft();
  mRectTop=0;
  mTextCacheScrollX=mScrollX;
  final float textCacheRight=Math.min(left + layout.getLineRight(0) + mPaddingH,mScrollX + mRight - mLeft) + hPadding;
  final float textCacheBottom=top + layout.getLineBottom(0) + mPaddingV+ vPadding;
  mCache=Bitmap.createBitmap((int)(textCacheRight - mTextCacheLeft),(int)(textCacheBottom - mTextCacheTop),Config.ARGB_8888);
  mCacheCanvas.setBitmap(mCache);
  mCacheCanvas.translate(-mTextCacheLeft,-mTextCacheTop);
  mIsBuildingCache=true;
  setAlpha(1.0f);
  draw(mCacheCanvas);
  setAlpha(prevAlpha);
  mIsBuildingCache=false;
  setText(" ");
}
