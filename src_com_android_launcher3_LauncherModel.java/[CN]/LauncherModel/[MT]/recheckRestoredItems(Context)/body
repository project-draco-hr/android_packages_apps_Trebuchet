{
  Runnable r=new Runnable(){
    @Override public void run(){
      LauncherAppsCompat launcherApps=LauncherAppsCompat.getInstance(context);
      HashSet<String> installedPackages=new HashSet<String>();
      UserHandleCompat user=UserHandleCompat.myUserHandle();
synchronized (sBgLock) {
        for (        ItemInfo info : sBgItemsIdMap.values()) {
          if (info instanceof ShortcutInfo) {
            ShortcutInfo si=(ShortcutInfo)info;
            if (si.isPromise() && si.getTargetComponent() != null && launcherApps.isPackageEnabledForProfile(si.getTargetComponent().getPackageName(),user)) {
              installedPackages.add(si.getTargetComponent().getPackageName());
            }
          }
 else           if (info instanceof LauncherAppWidgetInfo) {
            LauncherAppWidgetInfo widget=(LauncherAppWidgetInfo)info;
            if (widget.hasRestoreFlag(LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY) && launcherApps.isPackageEnabledForProfile(widget.providerName.getPackageName(),user)) {
              installedPackages.add(widget.providerName.getPackageName());
            }
          }
        }
      }
      if (!installedPackages.isEmpty()) {
        final ArrayList<AppInfo> restoredApps=new ArrayList<AppInfo>();
        for (        String pkg : installedPackages) {
          for (          LauncherActivityInfoCompat info : launcherApps.getActivityList(pkg,user)) {
            restoredApps.add(new AppInfo(context,info,user,mIconCache,null));
          }
        }
        final Callbacks callbacks=mCallbacks != null ? mCallbacks.get() : null;
        if (!restoredApps.isEmpty()) {
          mHandler.post(new Runnable(){
            public void run(){
              Callbacks cb=mCallbacks != null ? mCallbacks.get() : null;
              if (callbacks == cb && cb != null) {
                callbacks.bindAppsRestored(restoredApps);
              }
            }
          }
);
        }
      }
    }
  }
;
  sWorker.post(r);
}
