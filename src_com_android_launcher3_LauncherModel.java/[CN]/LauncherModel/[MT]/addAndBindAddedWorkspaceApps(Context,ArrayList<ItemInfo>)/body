{
  final Callbacks callbacks=getCallback();
  if (workspaceApps == null) {
    throw new RuntimeException("workspaceApps and allAppsApps must not be null");
  }
  if (workspaceApps.isEmpty()) {
    return;
  }
  Runnable r=new Runnable(){
    public void run(){
      final ArrayList<ItemInfo> addedShortcutsFinal=new ArrayList<ItemInfo>();
      final ArrayList<Long> addedWorkspaceScreensFinal=new ArrayList<Long>();
      ArrayList<Long> workspaceScreens=new ArrayList<Long>();
      TreeMap<Integer,Long> orderedScreens=loadWorkspaceScreensDb(context);
      for (      Integer i : orderedScreens.keySet()) {
        long screenId=orderedScreens.get(i);
        workspaceScreens.add(screenId);
      }
synchronized (sBgLock) {
        Iterator<ItemInfo> iter=workspaceApps.iterator();
        while (iter.hasNext()) {
          ItemInfo a=iter.next();
          final String name=a.title.toString();
          final Intent launchIntent=a.getIntent();
          if (shortcutExists(context,name,launchIntent,a.user)) {
            continue;
          }
          int startSearchPageIndex=workspaceScreens.isEmpty() ? 0 : 1;
          Pair<Long,int[]> coords=LauncherModel.findNextAvailableIconSpace(context,name,launchIntent,startSearchPageIndex,workspaceScreens);
          if (coords == null) {
            LauncherProvider lp=LauncherAppState.getLauncherProvider();
            int numPagesToAdd=Math.max(1,startSearchPageIndex + 1 - workspaceScreens.size());
            while (numPagesToAdd > 0) {
              long screenId=lp.generateNewScreenId();
              workspaceScreens.add(screenId);
              addedWorkspaceScreensFinal.add(screenId);
              numPagesToAdd--;
            }
            coords=LauncherModel.findNextAvailableIconSpace(context,name,launchIntent,startSearchPageIndex,workspaceScreens);
          }
          if (coords == null) {
            throw new RuntimeException("Coordinates should not be null");
          }
          ShortcutInfo shortcutInfo;
          if (a instanceof ShortcutInfo) {
            shortcutInfo=(ShortcutInfo)a;
          }
 else           if (a instanceof AppInfo) {
            shortcutInfo=((AppInfo)a).makeShortcut();
          }
 else {
            throw new RuntimeException("Unexpected info type");
          }
          addItemToDatabase(context,shortcutInfo,LauncherSettings.Favorites.CONTAINER_DESKTOP,coords.first,coords.second[0],coords.second[1],false);
          addedShortcutsFinal.add(shortcutInfo);
        }
      }
      updateWorkspaceScreenOrder(context,workspaceScreens);
      if (!addedShortcutsFinal.isEmpty()) {
        runOnMainThread(new Runnable(){
          public void run(){
            Callbacks cb=getCallback();
            if (callbacks == cb && cb != null) {
              final ArrayList<ItemInfo> addAnimated=new ArrayList<ItemInfo>();
              final ArrayList<ItemInfo> addNotAnimated=new ArrayList<ItemInfo>();
              if (!addedShortcutsFinal.isEmpty()) {
                ItemInfo info=addedShortcutsFinal.get(addedShortcutsFinal.size() - 1);
                long lastScreenId=info.screenId;
                for (                ItemInfo i : addedShortcutsFinal) {
                  if (i.screenId == lastScreenId) {
                    addAnimated.add(i);
                  }
 else {
                    addNotAnimated.add(i);
                  }
                }
              }
              callbacks.bindAppsAdded(addedWorkspaceScreensFinal,addNotAnimated,addAnimated,null);
            }
          }
        }
);
      }
    }
  }
;
  runOnWorkerThread(r);
}
