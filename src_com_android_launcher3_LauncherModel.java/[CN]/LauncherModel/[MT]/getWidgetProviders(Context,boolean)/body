{
synchronized (sBgLock) {
    if (sBgWidgetProviders == null || refresh) {
      sBgWidgetProviders=new HashMap<>();
      AppWidgetManagerCompat wm=AppWidgetManagerCompat.getInstance(context);
      LauncherAppWidgetProviderInfo info;
      List<AppWidgetProviderInfo> widgets=wm.getAllProviders();
      for (      AppWidgetProviderInfo pInfo : widgets) {
        info=LauncherAppWidgetProviderInfo.fromProviderInfo(context,pInfo);
        UserHandleCompat user=wm.getUser(info);
        sBgWidgetProviders.put(new ComponentKey(info.provider,user),info);
      }
      Collection<CustomAppWidget> customWidgets=Launcher.getCustomAppWidgets().values();
      for (      CustomAppWidget widget : customWidgets) {
        info=new LauncherAppWidgetProviderInfo(context,widget);
        UserHandleCompat user=wm.getUser(info);
        sBgWidgetProviders.put(new ComponentKey(info.provider,user),info);
      }
    }
    return new ArrayList<LauncherAppWidgetProviderInfo>(sBgWidgetProviders.values());
  }
}
