{
  Log.d(TAG,"normalizing icons");
  db.beginTransaction();
  Cursor c=null;
  SQLiteStatement update=null;
  try {
    boolean logged=false;
    update=db.compileStatement("UPDATE favorites " + "SET icon=? WHERE _id=?");
    c=db.rawQuery("SELECT _id, icon FROM favorites WHERE iconType=" + Favorites.ICON_TYPE_BITMAP,null);
    final int idIndex=c.getColumnIndexOrThrow(Favorites._ID);
    final int iconIndex=c.getColumnIndexOrThrow(Favorites.ICON);
    while (c.moveToNext()) {
      long id=c.getLong(idIndex);
      byte[] data=c.getBlob(iconIndex);
      try {
        Bitmap bitmap=Utilities.createIconBitmap(BitmapFactory.decodeByteArray(data,0,data.length),mContext);
        if (bitmap != null) {
          update.bindLong(1,id);
          data=ItemInfo.flattenBitmap(bitmap);
          if (data != null) {
            update.bindBlob(2,data);
            update.execute();
          }
          bitmap.recycle();
        }
      }
 catch (      Exception e) {
        if (!logged) {
          Log.e(TAG,"Failed normalizing icon " + id,e);
        }
 else {
          Log.e(TAG,"Also failed normalizing icon " + id);
        }
        logged=true;
      }
    }
    db.setTransactionSuccessful();
  }
 catch (  SQLException ex) {
    Log.w(TAG,"Problem while allocating appWidgetIds for existing widgets",ex);
  }
 finally {
    db.endTransaction();
    if (update != null) {
      update.close();
    }
    if (c != null) {
      c.close();
    }
  }
}
