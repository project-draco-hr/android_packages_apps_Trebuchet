{
  Bitmap tempBitmap=mCachedShortcutPreviewBitmap.get();
  final Canvas c=mCachedShortcutPreviewCanvas.get();
  if (tempBitmap == null || tempBitmap.getWidth() != maxWidth || tempBitmap.getHeight() != maxHeight) {
    tempBitmap=Bitmap.createBitmap(maxWidth,maxHeight,Config.ARGB_8888);
    mCachedShortcutPreviewBitmap.set(tempBitmap);
  }
 else {
    c.setBitmap(tempBitmap);
    c.drawColor(0,PorterDuff.Mode.CLEAR);
    c.setBitmap(null);
  }
  Drawable icon=mutateOnMainThread(mIconCache.getFullResIcon(info));
  int paddingTop=mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_top);
  int paddingLeft=mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_left);
  int paddingRight=mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_right);
  int scaledIconWidth=(maxWidth - paddingLeft - paddingRight);
  renderDrawableToBitmap(icon,tempBitmap,paddingLeft,paddingTop,scaledIconWidth,scaledIconWidth);
  if (preview != null && (preview.getWidth() != maxWidth || preview.getHeight() != maxHeight)) {
    throw new RuntimeException("Improperly sized bitmap passed as argument");
  }
 else   if (preview == null) {
    preview=Bitmap.createBitmap(maxWidth,maxHeight,Config.ARGB_8888);
  }
  c.setBitmap(preview);
  Paint p=mCachedShortcutPreviewPaint.get();
  if (p == null) {
    p=new Paint();
    ColorMatrix colorMatrix=new ColorMatrix();
    colorMatrix.setSaturation(0);
    p.setColorFilter(new ColorMatrixColorFilter(colorMatrix));
    p.setAlpha((int)(255 * 0.06f));
    mCachedShortcutPreviewPaint.set(p);
  }
  c.drawBitmap(tempBitmap,0,0,p);
  c.setBitmap(null);
  renderDrawableToBitmap(icon,preview,0,0,mAppIconSize,mAppIconSize);
  return preview;
}
