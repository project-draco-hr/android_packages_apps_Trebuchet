{
  Bitmap unusedBitmap=null;
synchronized (mUnusedBitmaps) {
    for (    Bitmap candidate : mUnusedBitmaps) {
      if (candidate != null && candidate.isMutable() && candidate.getWidth() == mPreviewWidth && candidate.getHeight() == mPreviewHeight) {
        unusedBitmap=candidate;
        break;
      }
    }
    if (unusedBitmap == null) {
      unusedBitmap=Bitmap.createBitmap(mPreviewWidth,mPreviewHeight,Config.ARGB_8888);
    }
 else {
      mUnusedBitmaps.remove(unusedBitmap);
    }
  }
  if (isCancelled()) {
    return null;
  }
  Bitmap preview=readFromDb(mKey,unusedBitmap);
  if (!isCancelled() && preview == null) {
    long[] versions=getPackageVersion(mKey.componentName.getPackageName());
    preview=generatePreview(mInfo,unusedBitmap,mPreviewWidth,mPreviewHeight);
    if (!isCancelled()) {
      writeToDb(mKey,versions,preview);
    }
  }
  return preview;
}
