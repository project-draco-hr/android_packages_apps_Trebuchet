{
  mRunning=true;
  android.os.Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
  Intent mainIntent=new Intent(Intent.ACTION_MAIN,null);
  mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);
  final Launcher launcher=mLauncher.get();
  final PackageManager manager=launcher.getPackageManager();
  final List<ResolveInfo> apps=manager.queryIntentActivities(mainIntent,0);
  if (apps != null && !mStopped) {
    final int count=apps.size();
    final ApplicationsAdapter applicationList=mApplicationsAdapter;
    ChangeNotifier action=new ChangeNotifier(applicationList);
    for (int i=0; i < count && !mStopped; i++) {
      ApplicationInfo application=new ApplicationInfo();
      ResolveInfo info=apps.get(i);
      application.title=info.loadLabel(manager);
      if (application.title == null) {
        application.title=info.activityInfo.name;
      }
      application.setActivity(new ComponentName(info.activityInfo.applicationInfo.packageName,info.activityInfo.name),Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED);
      application.icon=info.activityInfo.loadIcon(manager);
      application.container=ItemInfo.NO_ID;
      action.add(application);
    }
    action.sort(new Comparator<ApplicationInfo>(){
      public final int compare(      ApplicationInfo a,      ApplicationInfo b){
        return sCollator.compare(a.title.toString(),b.title.toString());
      }
    }
);
    if (!mStopped) {
      launcher.runOnUiThread(action);
    }
  }
  if (!mStopped) {
    mApplicationsLoaded=true;
  }
  mRunning=false;
}
