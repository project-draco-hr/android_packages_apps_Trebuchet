{
  Runnable cleanUpRunnable=null;
  if (d.dragSource != mLauncher.getWorkspace() && !(d.dragSource instanceof Folder)) {
    cleanUpRunnable=new Runnable(){
      @Override public void run(){
        mLauncher.exitSpringLoadedDragModeDelayed(true,Launcher.EXIT_SPRINGLOADED_MODE_SHORT_TIMEOUT,null);
      }
    }
;
  }
  View currentDragView;
  ShortcutInfo si=mCurrentDragInfo;
  if (mIsExternalDrag) {
    si.cellX=mEmptyCell[0];
    si.cellY=mEmptyCell[1];
    LauncherModel.addOrMoveItemInDatabase(mLauncher,si,mInfo.id,0,si.cellX,si.cellY);
    if (d.dragSource != this) {
      updateItemLocationsInDatabaseBatch();
    }
    mIsExternalDrag=false;
    currentDragView=createAndAddShortcut(si);
  }
 else {
    currentDragView=mCurrentDragView;
    CellLayout.LayoutParams lp=(CellLayout.LayoutParams)currentDragView.getLayoutParams();
    si.cellX=lp.cellX=mEmptyCell[0];
    si.cellX=lp.cellY=mEmptyCell[1];
    mContent.addViewToCellLayout(currentDragView,-1,(int)si.id,lp,true);
  }
  if (d.dragView.hasDrawn()) {
    float scaleX=getScaleX();
    float scaleY=getScaleY();
    setScaleX(1.0f);
    setScaleY(1.0f);
    mLauncher.getDragLayer().animateViewIntoPosition(d.dragView,currentDragView,cleanUpRunnable,null);
    setScaleX(scaleX);
    setScaleY(scaleY);
  }
 else {
    d.deferDragViewCleanupPostAnimation=false;
    currentDragView.setVisibility(VISIBLE);
  }
  mItemsInvalidated=true;
  setupContentDimensions(getItemCount());
  mSuppressOnAdd=true;
  mInfo.add(si);
  mSuppressOnAdd=false;
  mCurrentDragInfo=null;
}
