{
  DragLayer.LayoutParams lp=(DragLayer.LayoutParams)getLayoutParams();
  DragLayer parent=(DragLayer)mLauncher.findViewById(R.id.drag_layer);
  int width=getPaddingLeft() + getPaddingRight() + mContent.getDesiredWidth();
  int height=getFolderHeight();
  float scale=parent.getDescendantRectRelativeToSelf(mFolderIcon,sTempRect);
  DeviceProfile grid=mLauncher.getDeviceProfile();
  int centerX=(int)(sTempRect.left + sTempRect.width() * scale / 2);
  int centerY=(int)(sTempRect.top + sTempRect.height() * scale / 2);
  int centeredLeft=centerX - width / 2;
  int centeredTop=centerY - height / 2;
  mLauncher.getWorkspace().getPageAreaRelativeToDragLayer(sTempRect);
  int left=Math.min(Math.max(sTempRect.left,centeredLeft),sTempRect.left + sTempRect.width() - width);
  int top=Math.min(Math.max(sTempRect.top,centeredTop),sTempRect.top + sTempRect.height() - height);
  if (grid.isPhone && (grid.availableWidthPx - width) < grid.iconSizePx) {
    left=(grid.availableWidthPx - width) / 2;
  }
 else   if (width >= sTempRect.width()) {
    left=sTempRect.left + (sTempRect.width() - width) / 2;
  }
  if (height >= sTempRect.height()) {
    top=sTempRect.top + (sTempRect.height() - height) / 2;
  }
  int folderPivotX=width / 2 + (centeredLeft - left);
  int folderPivotY=height / 2 + (centeredTop - top);
  setPivotX(folderPivotX);
  setPivotY(folderPivotY);
  mFolderIconPivotX=(int)(mFolderIcon.getMeasuredWidth() * (1.0f * folderPivotX / width));
  mFolderIconPivotY=(int)(mFolderIcon.getMeasuredHeight() * (1.0f * folderPivotY / height));
  lp.width=width;
  lp.height=height;
  lp.x=left;
  lp.y=top;
}
