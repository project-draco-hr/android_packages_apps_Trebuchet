{
  TextView textView;
  if (convertView == null) {
    LayoutInflater inflater=(LayoutInflater)mLauncher.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    textView=(TextView)inflater.inflate(R.layout.home_customization_drawer_widget,parent,false);
  }
 else {
    textView=(TextView)convertView;
  }
  AppWidgetProviderInfo info=mWidgets.get(position);
  PackageManager packageManager=mLauncher.getPackageManager();
  String packageName=info.provider.getPackageName();
  Drawable drawable=null;
  if (info.previewImage != 0) {
    drawable=packageManager.getDrawable(packageName,info.previewImage,null);
    if (drawable == null) {
      Log.w(TAG,"Can't load icon drawable 0x" + Integer.toHexString(info.icon) + " for provider: "+ info.provider);
    }
  }
  if (drawable == null) {
    Resources resources=mLauncher.getResources();
    mLauncher.getWorkspace().estimateChildSize(info.minWidth,info.minHeight,mTempSize);
    final int width=mTempSize[0];
    final int height=mTempSize[1];
    Bitmap bitmap=Bitmap.createBitmap(width,height,Config.ARGB_8888);
    mCanvas.setBitmap(bitmap);
    mCanvas.clipRect(0,0,width,height,Op.REPLACE);
    Drawable background=resources.getDrawable(R.drawable.default_widget_preview);
    background.setBounds(0,0,width,height);
    background.draw(mCanvas);
    Drawable icon=packageManager.getDrawable(packageName,info.icon,null);
    background.getPadding(mTempRect);
    final int left=mTempRect.left;
    final int top=(height - icon.getIntrinsicHeight()) / 2;
    icon.setBounds(left,top,left + icon.getIntrinsicWidth(),top + icon.getIntrinsicHeight());
    icon.draw(mCanvas);
    drawable=new BitmapDrawable(resources,bitmap);
  }
  drawable.setBounds(0,0,drawable.getIntrinsicWidth(),drawable.getIntrinsicHeight());
  textView.setCompoundDrawables(null,drawable,null,null);
  textView.setText(info.label);
  textView.setTag(info);
  return textView;
}
