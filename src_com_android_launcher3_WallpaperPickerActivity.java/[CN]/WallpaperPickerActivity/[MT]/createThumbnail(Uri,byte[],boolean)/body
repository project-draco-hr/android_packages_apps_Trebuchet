{
  Resources res=getResources();
  int width=res.getDimensionPixelSize(R.dimen.wallpaperThumbnailWidth);
  int height=res.getDimensionPixelSize(R.dimen.wallpaperThumbnailHeight);
  BitmapCropTask cropTask;
  if (uri != null) {
    cropTask=new BitmapCropTask(uri,null,width,height,false,true,null);
  }
 else {
    cropTask=new BitmapCropTask(imageBytes,null,width,height,false,true,null);
  }
  Point bounds=cropTask.getImageBounds();
  if (bounds == null) {
    return null;
  }
  RectF cropRect=WallpaperCropActivity.getMaxCropRect(bounds.x,bounds.y,width,height,leftAligned);
  cropTask.setCropBounds(cropRect);
  if (cropTask.cropBitmap()) {
    return cropTask.getCroppedBitmap();
  }
 else {
    return null;
  }
}
