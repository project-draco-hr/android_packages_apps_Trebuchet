{
  final int action=ev.getAction();
  if ((action == MotionEvent.ACTION_MOVE) && (mTouchState == TOUCH_STATE_SCROLLING)) {
    return true;
  }
switch (action & MotionEvent.ACTION_MASK) {
case MotionEvent.ACTION_MOVE:
{
      if (mActivePointerId != INVALID_POINTER) {
        determineScrollingStart(ev);
        break;
      }
    }
case MotionEvent.ACTION_DOWN:
{
    final float x=ev.getX();
    final float y=ev.getY();
    mDownMotionX=x;
    mLastMotionX=x;
    mLastMotionY=y;
    mActivePointerId=ev.getPointerId(0);
    mAllowLongPress=true;
    final int xDist=(mScroller.getFinalX() - mScroller.getCurrX());
    final boolean finishedScrolling=(mScroller.isFinished() || xDist < mTouchSlop);
    if (finishedScrolling) {
      mTouchState=TOUCH_STATE_REST;
      mScroller.abortAnimation();
    }
 else {
      mTouchState=TOUCH_STATE_SCROLLING;
    }
    if ((mTouchState != TOUCH_STATE_PREV_PAGE) && (mTouchState != TOUCH_STATE_NEXT_PAGE)) {
      if (getChildCount() > 0) {
        int width=getMeasuredWidth();
        int offset=getRelativeChildOffset(mCurrentPage);
        if (x < offset) {
          mTouchState=TOUCH_STATE_PREV_PAGE;
        }
 else         if (x > (width - offset)) {
          mTouchState=TOUCH_STATE_NEXT_PAGE;
        }
      }
    }
    break;
  }
case MotionEvent.ACTION_CANCEL:
case MotionEvent.ACTION_UP:
pageEndMoving();
mTouchState=TOUCH_STATE_REST;
mAllowLongPress=false;
mActivePointerId=INVALID_POINTER;
break;
case MotionEvent.ACTION_POINTER_UP:
onSecondaryPointerUp(ev);
break;
}
return mTouchState != TOUCH_STATE_REST;
}
