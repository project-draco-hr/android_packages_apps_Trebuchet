{
  if (mFirstLayout && mCurrentPage >= 0 && mCurrentPage < getChildCount()) {
    setHorizontalScrollBarEnabled(false);
    int newX=getChildOffset(mCurrentPage) - getRelativeChildOffset(mCurrentPage);
    scrollTo(newX,0);
    mScroller.setFinalX(newX);
    setHorizontalScrollBarEnabled(true);
    mFirstLayout=false;
  }
  final int childCount=getChildCount();
  int childLeft=0;
  if (childCount > 0) {
    childLeft=getRelativeChildOffset(0);
  }
  for (int i=0; i < childCount; i++) {
    final View child=getChildAt(i);
    if (child.getVisibility() != View.GONE) {
      final int childWidth=child.getMeasuredWidth();
      final int childHeight=(getMeasuredHeight() - child.getMeasuredHeight()) / 2;
      child.layout(childLeft,childHeight,childLeft + childWidth,childHeight + child.getMeasuredHeight());
      childLeft+=childWidth + mPageSpacing;
    }
  }
}
