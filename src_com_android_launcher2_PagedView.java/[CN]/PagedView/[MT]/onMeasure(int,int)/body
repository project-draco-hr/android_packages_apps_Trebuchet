{
  final int widthMode=MeasureSpec.getMode(widthMeasureSpec);
  final int widthSize=MeasureSpec.getSize(widthMeasureSpec);
  if (widthMode != MeasureSpec.EXACTLY) {
    throw new IllegalStateException("Workspace can only be used in EXACTLY mode.");
  }
  final int heightMode=MeasureSpec.getMode(heightMeasureSpec);
  final int heightSize=MeasureSpec.getSize(heightMeasureSpec);
  if (heightMode != MeasureSpec.EXACTLY) {
    throw new IllegalStateException("Workspace can only be used in EXACTLY mode.");
  }
  final int childCount=getChildCount();
  for (int i=0; i < childCount; i++) {
    final View child=getChildAt(i);
    final LayoutParams lp=(LayoutParams)child.getLayoutParams();
    int childWidthMode;
    if (lp.width == LayoutParams.WRAP_CONTENT) {
      childWidthMode=MeasureSpec.AT_MOST;
    }
 else {
      childWidthMode=MeasureSpec.EXACTLY;
    }
    int childHeightMode;
    if (lp.height == LayoutParams.WRAP_CONTENT) {
      childHeightMode=MeasureSpec.AT_MOST;
    }
 else {
      childHeightMode=MeasureSpec.EXACTLY;
    }
    final int childWidthMeasureSpec=MeasureSpec.makeMeasureSpec(widthSize,childWidthMode);
    final int childHeightMeasureSpec=MeasureSpec.makeMeasureSpec(heightSize,childHeightMode);
    child.measure(childWidthMeasureSpec,childHeightMeasureSpec);
  }
  setMeasuredDimension(widthSize,heightSize);
  if (mFirstLayout && mCurrentPage >= 0 && mCurrentPage < getChildCount()) {
    setHorizontalScrollBarEnabled(false);
    scrollTo(getChildOffset(mCurrentPage) - getRelativeChildOffset(mCurrentPage),0);
    mScroller.setFinalX(getChildOffset(mCurrentPage) - getRelativeChildOffset(mCurrentPage));
    setHorizontalScrollBarEnabled(true);
    mFirstLayout=false;
  }
}
