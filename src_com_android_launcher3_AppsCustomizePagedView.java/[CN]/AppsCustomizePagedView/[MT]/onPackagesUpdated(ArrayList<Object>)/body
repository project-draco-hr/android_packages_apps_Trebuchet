{
  LauncherAppState app=LauncherAppState.getInstance();
  DeviceProfile grid=app.getDynamicGrid().getDeviceProfile();
  mWidgets.clear();
  for (  Object o : widgetsAndShortcuts) {
    if (o instanceof AppWidgetProviderInfo) {
      AppWidgetProviderInfo widget=(AppWidgetProviderInfo)o;
      widget.label=widget.label.trim();
      if (widget.minWidth > 0 && widget.minHeight > 0) {
        int[] spanXY=Launcher.getSpanForWidget(mLauncher,widget);
        int[] minSpanXY=Launcher.getMinSpanForWidget(mLauncher,widget);
        int minSpanX=Math.min(spanXY[0],minSpanXY[0]);
        int minSpanY=Math.min(spanXY[1],minSpanXY[1]);
        if (minSpanX <= (int)grid.numColumns && minSpanY <= (int)grid.numRows) {
          mWidgets.add(widget);
        }
 else {
          Log.e(TAG,"Widget " + widget.provider + " can not fit on this device ("+ widget.minWidth+ ", "+ widget.minHeight+ ")");
        }
      }
 else {
        Log.e(TAG,"Widget " + widget.provider + " has invalid dimensions ("+ widget.minWidth+ ", "+ widget.minHeight+ ")");
      }
    }
 else {
      mWidgets.add(o);
    }
  }
  updatePageCountsAndInvalidateData();
}
