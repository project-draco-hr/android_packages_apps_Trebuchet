{
  CellLayout cur=(CellLayout)getChildAt(mCurrentPage);
  CellLayout toRight=(CellLayout)getChildAt(mCurrentPage + 1);
  CellLayout toLeft=(CellLayout)getChildAt(mCurrentPage - 1);
  for (int i=0; i < mCurrentPage - 1; i++) {
    View v=getChildAt(i);
    if (v != null) {
      v.setRotationY(WORKSPACE_ROTATION);
      v.setScaleX(getScaleXForRotation(WORKSPACE_ROTATION));
    }
  }
  for (int i=mCurrentPage + 1; i < getChildCount(); i++) {
    View v=getChildAt(i);
    if (v != null) {
      v.setRotationY(-WORKSPACE_ROTATION);
      v.setScaleX(getScaleXForRotation(-WORKSPACE_ROTATION));
    }
  }
  int halfScreenSize=getMeasuredWidth() / 2;
  int pageWidth=cur.getMeasuredWidth();
  int delta=screenCenter - (getChildOffset(mCurrentPage) - getRelativeChildOffset(mCurrentPage) + halfScreenSize);
  float scrollProgress=Math.abs(delta / (pageWidth * 1.0f + mPageSpacing));
  boolean scrollRight=(delta <= 0);
  float rotation;
  if (scrollRight) {
    rotation=-scrollProgress * WORKSPACE_ROTATION;
    cur.setRotationY(rotation);
    cur.setScaleX(getScaleXForRotation(rotation));
    if (toLeft != null) {
      rotation=WORKSPACE_ROTATION * (1 - scrollProgress);
      toLeft.setRotationY(rotation);
      toLeft.setScaleX(getScaleXForRotation(rotation));
    }
    if (toRight != null) {
      toRight.setRotationY(-WORKSPACE_ROTATION);
      toRight.setScaleX(getScaleXForRotation(WORKSPACE_ROTATION));
    }
  }
 else {
    rotation=scrollProgress * WORKSPACE_ROTATION;
    cur.setRotationY(rotation);
    cur.setScaleX(getScaleXForRotation(rotation));
    if (toRight != null) {
      rotation=-WORKSPACE_ROTATION * (1 - scrollProgress);
      toRight.setRotationY(rotation);
      toRight.setScaleX(getScaleXForRotation(rotation));
    }
    if (toLeft != null) {
      toLeft.setRotationY(WORKSPACE_ROTATION);
      toLeft.setScaleX(getScaleXForRotation(WORKSPACE_ROTATION));
    }
  }
}
