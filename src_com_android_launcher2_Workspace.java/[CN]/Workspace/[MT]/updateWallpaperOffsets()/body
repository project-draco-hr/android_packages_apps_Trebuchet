{
  boolean updateNow=false;
  boolean keepUpdating=true;
  if (mUpdateWallpaperOffsetImmediately) {
    updateNow=true;
    keepUpdating=false;
    mWallpaperOffset.jumpToFinal();
    mUpdateWallpaperOffsetImmediately=false;
  }
 else {
    updateNow=keepUpdating=mWallpaperOffset.computeScrollOffset();
  }
  if (updateNow) {
    if (mWindowToken != null) {
      mWallpaperManager.setWallpaperOffsets(mWindowToken,mWallpaperOffset.getCurrX(),mWallpaperOffset.getCurrY());
    }
  }
  if (keepUpdating) {
    fastInvalidate();
  }
}
