{
  if (mScroller.computeScrollOffset()) {
    mTouchX=mScrollX=mScroller.getCurrX();
    mSmoothingTime=System.nanoTime() / NANOTIME_DIV;
    mScrollY=mScroller.getCurrY();
    updateWallpaperOffset();
    postInvalidate();
  }
 else   if (mNextScreen != INVALID_SCREEN) {
    mCurrentScreen=Math.max(0,Math.min(mNextScreen,getChildCount() - 1));
    mPreviousIndicator.setLevel(mCurrentScreen);
    mNextIndicator.setLevel(mCurrentScreen);
    Launcher.setScreen(mCurrentScreen);
    mNextScreen=INVALID_SCREEN;
    clearChildrenCache();
  }
 else   if (mTouchState == TOUCH_STATE_SCROLLING) {
    final float now=System.nanoTime() / NANOTIME_DIV;
    final float e=(float)Math.exp((now - mSmoothingTime) / SMOOTHING_CONSTANT);
    final float dx=mTouchX - mScrollX;
    mScrollX+=dx * e;
    mSmoothingTime=now;
    if (dx > 1.f || dx < -1.f) {
      updateWallpaperOffset();
      postInvalidate();
    }
  }
}
