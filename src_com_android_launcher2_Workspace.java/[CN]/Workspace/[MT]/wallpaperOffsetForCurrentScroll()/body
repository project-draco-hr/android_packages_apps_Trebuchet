{
  final boolean isStaticWallpaper=mIsStaticWallpaper;
  int wallpaperTravelWidth=mWallpaperTravelWidth;
  if (!isStaticWallpaper) {
    wallpaperTravelWidth=mWallpaperWidth;
  }
  mWallpaperManager.setWallpaperOffsetSteps(1.0f / (getChildCount() - 1),1.0f / (3 - 1));
  float layoutScale=mLayoutScale;
  mLayoutScale=1f;
  int scrollRange=getScrollRange();
  float scrollProgressOffset=0;
  if (isStaticWallpaper) {
    int overScrollOffset=(int)(maxOverScroll() * mDisplayWidth);
    scrollProgressOffset+=overScrollOffset / (float)getScrollRange();
    scrollRange+=2 * overScrollOffset;
  }
  boolean overScrollWallpaper=LauncherApplication.isScreenLarge();
  float adjustedScrollX=overScrollWallpaper ? mScrollX : Math.max(0,Math.min(mScrollX,mMaxScrollX));
  adjustedScrollX*=mWallpaperScrollRatio;
  mLayoutScale=layoutScale;
  float scrollProgress=adjustedScrollX / (float)scrollRange + scrollProgressOffset;
  float offsetInDips=wallpaperTravelWidth * scrollProgress + (mWallpaperWidth - wallpaperTravelWidth) / 2;
  float offset=offsetInDips / (float)mWallpaperWidth;
  return offset;
}
