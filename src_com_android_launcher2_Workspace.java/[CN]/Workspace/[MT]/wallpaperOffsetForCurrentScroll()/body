{
  mWallpaperManager.setWallpaperOffsetSteps(1.0f / (getChildCount() - 1),1.0f);
  float layoutScale=mLayoutScale;
  mLayoutScale=1f;
  int scrollRange=getScrollRange();
  float adjustedScrollX=Math.max(0,Math.min(mScrollX,mMaxScrollX));
  adjustedScrollX*=mWallpaperScrollRatio;
  mLayoutScale=layoutScale;
  float scrollProgress=adjustedScrollX / (float)scrollRange;
  if (LauncherApplication.isScreenLarge() && mIsStaticWallpaper) {
    int wallpaperTravelWidth=Math.min(mWallpaperTravelWidth,mWallpaperWidth);
    float offsetInDips=wallpaperTravelWidth * scrollProgress + (mWallpaperWidth - wallpaperTravelWidth) / 2;
    float offset=offsetInDips / (float)mWallpaperWidth;
    return offset;
  }
 else {
    return scrollProgress;
  }
}
