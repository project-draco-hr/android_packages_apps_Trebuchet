{
  Display display=mLauncher.getWindowManager().getDefaultDisplay();
  final boolean isStaticWallpaper=(mWallpaperManager.getWallpaperInfo() == null);
  int wallpaperTravelWidth=(int)(display.getWidth() * wallpaperTravelToScreenWidthRatio(display.getWidth(),display.getHeight()));
  if (!isStaticWallpaper) {
    wallpaperTravelWidth=mWallpaperWidth;
  }
  mWallpaperManager.setWallpaperOffsetSteps(1.0f / (getChildCount() - 1),1.0f / (3 - 1));
  int scrollRange=getScrollRange();
  float scrollProgressOffset=0;
  if (isStaticWallpaper) {
    int overscrollOffset=(int)(maxOverScroll() * display.getWidth());
    scrollProgressOffset+=overscrollOffset / (float)getScrollRange();
    scrollRange+=2 * overscrollOffset;
  }
  float scrollProgress=mScrollX / (float)scrollRange + scrollProgressOffset;
  float offsetInDips=wallpaperTravelWidth * scrollProgress + (mWallpaperWidth - wallpaperTravelWidth) / 2;
  float offset=offsetInDips / (float)mWallpaperWidth;
  return offset;
}
