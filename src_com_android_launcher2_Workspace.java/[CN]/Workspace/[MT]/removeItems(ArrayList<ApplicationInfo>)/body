{
  final int count=getChildCount();
  final PackageManager manager=getContext().getPackageManager();
  final AppWidgetManager widgets=AppWidgetManager.getInstance(getContext());
  final HashSet<String> packageNames=new HashSet<String>();
  final int appCount=apps.size();
  for (int i=0; i < appCount; i++) {
    packageNames.add(apps.get(i).componentName.getPackageName());
  }
  for (int i=0; i < count; i++) {
    final CellLayout layout=(CellLayout)getChildAt(i);
    post(new Runnable(){
      public void run(){
        final ArrayList<View> childrenToRemove=new ArrayList<View>();
        childrenToRemove.clear();
        int childCount=layout.getChildCount();
        for (int j=0; j < childCount; j++) {
          final View view=layout.getChildAt(j);
          Object tag=view.getTag();
          if (tag instanceof ShortcutInfo) {
            final ShortcutInfo info=(ShortcutInfo)tag;
            final Intent intent=info.intent;
            final ComponentName name=intent.getComponent();
            if (Intent.ACTION_MAIN.equals(intent.getAction()) && name != null) {
              for (              String packageName : packageNames) {
                if (packageName.equals(name.getPackageName())) {
                  LauncherModel.deleteItemFromDatabase(mLauncher,info);
                  childrenToRemove.add(view);
                }
              }
            }
          }
 else           if (tag instanceof UserFolderInfo) {
            final UserFolderInfo info=(UserFolderInfo)tag;
            final ArrayList<ShortcutInfo> contents=info.contents;
            final ArrayList<ShortcutInfo> toRemove=new ArrayList<ShortcutInfo>(1);
            final int contentsCount=contents.size();
            boolean removedFromFolder=false;
            for (int k=0; k < contentsCount; k++) {
              final ShortcutInfo appInfo=contents.get(k);
              final Intent intent=appInfo.intent;
              final ComponentName name=intent.getComponent();
              if (Intent.ACTION_MAIN.equals(intent.getAction()) && name != null) {
                for (                String packageName : packageNames) {
                  if (packageName.equals(name.getPackageName())) {
                    toRemove.add(appInfo);
                    LauncherModel.deleteItemFromDatabase(mLauncher,appInfo);
                    removedFromFolder=true;
                  }
                }
              }
            }
            contents.removeAll(toRemove);
            if (removedFromFolder) {
              final Folder folder=getOpenFolder();
              if (folder != null)               folder.notifyDataSetChanged();
            }
          }
 else           if (tag instanceof LiveFolderInfo) {
            final LiveFolderInfo info=(LiveFolderInfo)tag;
            final Uri uri=info.uri;
            final ProviderInfo providerInfo=manager.resolveContentProvider(uri.getAuthority(),0);
            if (providerInfo == null) {
              for (              String packageName : packageNames) {
                if (packageName.equals(providerInfo.packageName)) {
                  LauncherModel.deleteItemFromDatabase(mLauncher,info);
                  childrenToRemove.add(view);
                }
              }
            }
          }
 else           if (tag instanceof LauncherAppWidgetInfo) {
            final LauncherAppWidgetInfo info=(LauncherAppWidgetInfo)tag;
            final AppWidgetProviderInfo provider=widgets.getAppWidgetInfo(info.appWidgetId);
            if (provider == null) {
              for (              String packageName : packageNames) {
                if (packageName.equals(provider.provider.getPackageName())) {
                  LauncherModel.deleteItemFromDatabase(mLauncher,info);
                  childrenToRemove.add(view);
                }
              }
            }
          }
        }
        childCount=childrenToRemove.size();
        for (int j=0; j < childCount; j++) {
          View child=childrenToRemove.get(j);
          layout.removeViewInLayout(child);
          if (child instanceof DropTarget) {
            mDragController.removeDropTarget((DropTarget)child);
          }
        }
        if (childCount > 0) {
          layout.requestLayout();
          layout.invalidate();
        }
      }
    }
);
  }
}
