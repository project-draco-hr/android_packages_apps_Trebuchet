{
  final int screenCount=getChildCount();
  final PackageManager manager=getContext().getPackageManager();
  final AppWidgetManager widgets=AppWidgetManager.getInstance(getContext());
  final HashSet<String> packageNames=new HashSet<String>();
  final int appCount=apps.size();
  for (int i=0; i < appCount; i++) {
    packageNames.add(apps.get(i).componentName.getPackageName());
  }
  for (int i=0; i < screenCount; i++) {
    final CellLayout layoutParent=(CellLayout)getChildAt(i);
    final ViewGroup layout=layoutParent.getChildrenLayout();
    post(new Runnable(){
      public void run(){
        final ArrayList<View> childrenToRemove=new ArrayList<View>();
        childrenToRemove.clear();
        int childCount=layout.getChildCount();
        for (int j=0; j < childCount; j++) {
          final View view=layout.getChildAt(j);
          Object tag=view.getTag();
          if (tag instanceof ShortcutInfo) {
            final ShortcutInfo info=(ShortcutInfo)tag;
            final Intent intent=info.intent;
            final ComponentName name=intent.getComponent();
            if (Intent.ACTION_MAIN.equals(intent.getAction()) && name != null) {
              for (              String packageName : packageNames) {
                if (packageName.equals(name.getPackageName())) {
                  LauncherModel.deleteItemFromDatabase(mLauncher,info);
                  childrenToRemove.add(view);
                }
              }
            }
          }
 else           if (tag instanceof FolderInfo) {
            final FolderInfo info=(FolderInfo)tag;
            final ArrayList<ShortcutInfo> contents=info.contents;
            final int contentsCount=contents.size();
            final ArrayList<ShortcutInfo> appsToRemoveFromFolder=new ArrayList<ShortcutInfo>();
            for (int k=0; k < contentsCount; k++) {
              final ShortcutInfo appInfo=contents.get(k);
              final Intent intent=appInfo.intent;
              final ComponentName name=intent.getComponent();
              if (Intent.ACTION_MAIN.equals(intent.getAction()) && name != null) {
                for (                String packageName : packageNames) {
                  if (packageName.equals(name.getPackageName())) {
                    appsToRemoveFromFolder.add(appInfo);
                  }
                }
              }
            }
            for (            ShortcutInfo item : appsToRemoveFromFolder) {
              info.remove(item);
              LauncherModel.deleteItemFromDatabase(mLauncher,item);
            }
          }
 else           if (tag instanceof LauncherAppWidgetInfo) {
            final LauncherAppWidgetInfo info=(LauncherAppWidgetInfo)tag;
            final AppWidgetProviderInfo provider=widgets.getAppWidgetInfo(info.appWidgetId);
            if (provider != null) {
              for (              String packageName : packageNames) {
                if (packageName.equals(provider.provider.getPackageName())) {
                  LauncherModel.deleteItemFromDatabase(mLauncher,info);
                  childrenToRemove.add(view);
                }
              }
            }
          }
        }
        childCount=childrenToRemove.size();
        for (int j=0; j < childCount; j++) {
          View child=childrenToRemove.get(j);
          layoutParent.removeViewInLayout(child);
          if (child instanceof DropTarget) {
            mDragController.removeDropTarget((DropTarget)child);
          }
        }
        if (childCount > 0) {
          layout.requestLayout();
          layout.invalidate();
        }
      }
    }
);
  }
}
