{
  int screen=indexOfChild(cellLayout);
  if (screen != mCurrentPage && mShrinkState != ShrinkState.SPRING_LOADED) {
    snapToPage(screen);
  }
  if (dragInfo instanceof PendingAddItemInfo) {
    PendingAddItemInfo info=(PendingAddItemInfo)dragInfo;
switch (info.itemType) {
case LauncherSettings.Favorites.ITEM_TYPE_APPWIDGET:
      mLauncher.addAppWidgetFromDrop((PendingAddWidgetInfo)info,screen,touchXY);
    break;
case LauncherSettings.Favorites.ITEM_TYPE_SHORTCUT:
  mLauncher.processShortcutFromDrop(info.componentName,screen,touchXY);
break;
default :
throw new IllegalStateException("Unknown item type: " + info.itemType);
}
cellLayout.onDragExit();
}
 else {
ItemInfo info=(ItemInfo)dragInfo;
View view=null;
switch (info.itemType) {
case LauncherSettings.Favorites.ITEM_TYPE_APPLICATION:
case LauncherSettings.Favorites.ITEM_TYPE_SHORTCUT:
if (info.container == NO_ID && info instanceof ApplicationInfo) {
info=new ShortcutInfo((ApplicationInfo)info);
}
view=mLauncher.createShortcut(R.layout.application,cellLayout,(ShortcutInfo)info);
break;
case LauncherSettings.Favorites.ITEM_TYPE_FOLDER:
view=FolderIcon.fromXml(R.layout.folder_icon,mLauncher,cellLayout,(FolderInfo)info,mIconCache);
break;
default :
throw new IllegalStateException("Unknown item type: " + info.itemType);
}
int spanX=mDragInfo != null ? mDragInfo.spanX : 1;
int spanY=mDragInfo != null ? mDragInfo.spanY : 1;
if (touchXY != null) {
mTargetCell=findNearestArea((int)touchXY[0],(int)touchXY[1],spanX,spanY,cellLayout,mTargetCell);
if (createUserFolderIfNecessary(view,cellLayout,mTargetCell,true)) {
return;
}
if (addToExistingFolderIfNecessary(view,cellLayout,mTargetCell,dragInfo,true)) {
return;
}
}
if (touchXY != null) {
mTargetCell=findNearestVacantArea(touchXY[0],touchXY[1],1,1,null,cellLayout,mTargetCell);
}
 else {
cellLayout.findCellForSpan(mTargetCell,1,1);
}
addInScreen(view,indexOfChild(cellLayout),mTargetCell[0],mTargetCell[1],info.spanX,info.spanY,insertAtFirst);
cellLayout.onDropChild(view);
cellLayout.animateDrop();
CellLayout.LayoutParams lp=(CellLayout.LayoutParams)view.getLayoutParams();
cellLayout.getChildrenLayout().measureChild(view);
if (dragView != null) {
mLauncher.getDragLayer().animateViewIntoPosition(dragView,view);
}
LauncherModel.addOrMoveItemInDatabase(mLauncher,info,LauncherSettings.Favorites.CONTAINER_DESKTOP,screen,lp.cellX,lp.cellY);
}
}
