{
  boolean consume=FocusLogic.shouldConsume(keyCode);
  if (e.getAction() == KeyEvent.ACTION_UP) {
    return consume;
  }
  if (DEBUG) {
    Log.v(TAG,String.format("Handle ALL APPS keyevent=[%s].",KeyEvent.keyCodeToString(keyCode)));
  }
  ViewGroup parentLayout;
  ViewGroup itemContainer;
  int countX;
  int countY;
  if (v.getParent() instanceof ShortcutAndWidgetContainer) {
    itemContainer=(ViewGroup)v.getParent();
    parentLayout=(ViewGroup)itemContainer.getParent();
    countX=((CellLayout)parentLayout).getCountX();
    countY=((CellLayout)parentLayout).getCountY();
  }
 else   if (v.getParent() instanceof ViewGroup) {
    itemContainer=parentLayout=(ViewGroup)v.getParent();
    countX=((PagedViewGridLayout)parentLayout).getCellCountX();
    countY=((PagedViewGridLayout)parentLayout).getCellCountY();
  }
 else {
    throw new IllegalStateException("Parent of the focused item inside all apps screen is not a supported type.");
  }
  final int iconIndex=itemContainer.indexOfChild(v);
  final PagedView container=(PagedView)parentLayout.getParent();
  final int pageIndex=container.indexToPage(container.indexOfChild(parentLayout));
  final int pageCount=container.getChildCount();
  ViewGroup newParent=null;
  View child=null;
  int[][] matrix=FocusLogic.createFullMatrix(countX,countY,true);
  int newIconIndex=FocusLogic.handleKeyEvent(keyCode,countX,countY,matrix,iconIndex,pageIndex,pageCount);
  if (newIconIndex == FocusLogic.NOOP) {
    return consume;
  }
switch (newIconIndex) {
case FocusLogic.PREVIOUS_PAGE_RIGHT_COLUMN:
    newParent=getAppsCustomizePage(container,pageIndex - 1);
  if (newParent != null) {
    int row=FocusLogic.findRow(matrix,iconIndex);
    container.snapToPage(pageIndex - 1);
    child=newParent.getChildAt(matrix[countX - 1][row]);
  }
break;
case FocusLogic.PREVIOUS_PAGE_FIRST_ITEM:
newParent=getAppsCustomizePage(container,pageIndex - 1);
if (newParent != null) {
container.snapToPage(pageIndex - 1);
child=newParent.getChildAt(0);
}
break;
case FocusLogic.PREVIOUS_PAGE_LAST_ITEM:
newParent=getAppsCustomizePage(container,pageIndex - 1);
if (newParent != null) {
container.snapToPage(pageIndex - 1);
child=newParent.getChildAt(newParent.getChildCount() - 1);
}
break;
case FocusLogic.NEXT_PAGE_FIRST_ITEM:
newParent=getAppsCustomizePage(container,pageIndex + 1);
if (newParent != null) {
container.snapToPage(pageIndex + 1);
child=newParent.getChildAt(0);
}
break;
case FocusLogic.NEXT_PAGE_LEFT_COLUMN:
newParent=getAppsCustomizePage(container,pageIndex + 1);
if (newParent != null) {
container.snapToPage(pageIndex + 1);
int row=FocusLogic.findRow(matrix,iconIndex);
child=newParent.getChildAt(matrix[0][row]);
}
break;
case FocusLogic.CURRENT_PAGE_FIRST_ITEM:
child=container.getChildAt(0);
break;
case FocusLogic.CURRENT_PAGE_LAST_ITEM:
child=itemContainer.getChildAt(itemContainer.getChildCount() - 1);
break;
default :
child=itemContainer.getChildAt(newIconIndex);
break;
}
if (child != null) {
child.requestFocus();
playSoundEffect(keyCode,v);
}
return consume;
}
