{
  final PagedViewGridLayout parent=(PagedViewGridLayout)w.getParent();
  final PagedView container=(PagedView)parent.getParent();
  final TabHost tabHost=findTabHostParent(container);
  final TabWidget tabs=tabHost.getTabWidget();
  final int widgetIndex=parent.indexOfChild(w);
  final int widgetCount=parent.getChildCount();
  final int pageIndex=((PagedView)container).indexToPage(container.indexOfChild(parent));
  final int pageCount=container.getChildCount();
  final int cellCountX=parent.getCellCountX();
  final int cellCountY=parent.getCellCountY();
  final int x=widgetIndex % cellCountX;
  final int y=widgetIndex / cellCountX;
  final int action=e.getAction();
  final boolean handleKeyEvent=(action != KeyEvent.ACTION_UP);
  ViewGroup newParent=null;
  View child=null;
  boolean wasHandled=false;
switch (keyCode) {
case KeyEvent.KEYCODE_DPAD_LEFT:
    if (handleKeyEvent) {
      if (widgetIndex > 0) {
        parent.getChildAt(widgetIndex - 1).requestFocus();
      }
 else {
        if (pageIndex > 0) {
          newParent=getAppsCustomizePage(container,pageIndex - 1);
          if (newParent != null) {
            child=newParent.getChildAt(newParent.getChildCount() - 1);
            if (child != null)             child.requestFocus();
          }
        }
      }
    }
  wasHandled=true;
break;
case KeyEvent.KEYCODE_DPAD_RIGHT:
if (handleKeyEvent) {
if (widgetIndex < (widgetCount - 1)) {
  parent.getChildAt(widgetIndex + 1).requestFocus();
}
 else {
  if (pageIndex < (pageCount - 1)) {
    newParent=getAppsCustomizePage(container,pageIndex + 1);
    if (newParent != null) {
      child=newParent.getChildAt(0);
      if (child != null)       child.requestFocus();
    }
  }
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_DPAD_UP:
if (handleKeyEvent) {
if (y > 0) {
int newWidgetIndex=((y - 1) * cellCountX) + x;
child=parent.getChildAt(newWidgetIndex);
if (child != null) child.requestFocus();
}
 else {
tabs.requestFocus();
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_DPAD_DOWN:
if (handleKeyEvent) {
if (y < (cellCountY - 1)) {
int newWidgetIndex=Math.min(widgetCount - 1,((y + 1) * cellCountX) + x);
child=parent.getChildAt(newWidgetIndex);
if (child != null) child.requestFocus();
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_ENTER:
case KeyEvent.KEYCODE_DPAD_CENTER:
if (handleKeyEvent) {
View.OnClickListener clickListener=(View.OnClickListener)container;
clickListener.onClick(w);
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_PAGE_UP:
if (handleKeyEvent) {
if (pageIndex > 0) {
newParent=getAppsCustomizePage(container,pageIndex - 1);
if (newParent != null) {
child=newParent.getChildAt(0);
}
}
 else {
child=parent.getChildAt(0);
}
if (child != null) child.requestFocus();
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_PAGE_DOWN:
if (handleKeyEvent) {
if (pageIndex < (pageCount - 1)) {
newParent=getAppsCustomizePage(container,pageIndex + 1);
if (newParent != null) {
child=newParent.getChildAt(0);
}
}
 else {
child=parent.getChildAt(widgetCount - 1);
}
if (child != null) child.requestFocus();
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_MOVE_HOME:
if (handleKeyEvent) {
child=parent.getChildAt(0);
if (child != null) child.requestFocus();
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_MOVE_END:
if (handleKeyEvent) {
parent.getChildAt(widgetCount - 1).requestFocus();
}
wasHandled=true;
break;
default :
break;
}
return wasHandled;
}
