{
  final PagedViewCellLayoutChildren parent=(PagedViewCellLayoutChildren)v.getParent();
  final PagedViewCellLayout parentLayout=(PagedViewCellLayout)parent.getParent();
  final ViewGroup container=(ViewGroup)parentLayout.getParent();
  final TabHost tabHost=findTabHostParent(container);
  final TabWidget tabs=(TabWidget)tabHost.findViewById(com.android.internal.R.id.tabs);
  final int iconIndex=parent.indexOfChild(v);
  final int widgetCount=parent.getChildCount();
  final int pageIndex=container.indexOfChild(parentLayout);
  final int pageCount=container.getChildCount();
  final int cellCountX=parentLayout.getCellCountX();
  final int cellCountY=parentLayout.getCellCountY();
  final int x=iconIndex % cellCountX;
  final int y=iconIndex / cellCountX;
  final int action=e.getAction();
  final boolean handleKeyEvent=(action != KeyEvent.ACTION_UP);
  PagedViewCellLayoutChildren newParent=null;
  View child=null;
  boolean wasHandled=false;
switch (keyCode) {
case KeyEvent.KEYCODE_DPAD_LEFT:
    if (handleKeyEvent) {
      if (iconIndex > 0) {
        parent.getChildAt(iconIndex - 1).requestFocus();
      }
 else {
        if (pageIndex > 0) {
          newParent=getPagedViewCellLayoutChildrenForIndex(container,pageIndex - 1);
          if (newParent != null) {
            child=newParent.getChildAt(newParent.getChildCount() - 1);
            if (child != null)             child.requestFocus();
          }
        }
      }
    }
  wasHandled=true;
break;
case KeyEvent.KEYCODE_DPAD_RIGHT:
if (handleKeyEvent) {
if (iconIndex < (widgetCount - 1)) {
  parent.getChildAt(iconIndex + 1).requestFocus();
}
 else {
  if (pageIndex < (pageCount - 1)) {
    newParent=getPagedViewCellLayoutChildrenForIndex(container,pageIndex + 1);
    if (newParent != null) {
      child=newParent.getChildAt(0);
      if (child != null)       child.requestFocus();
    }
  }
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_DPAD_UP:
if (handleKeyEvent) {
if (y > 0) {
int newiconIndex=((y - 1) * cellCountX) + x;
parent.getChildAt(newiconIndex).requestFocus();
}
 else {
tabs.requestFocus();
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_DPAD_DOWN:
if (handleKeyEvent) {
if (y < (cellCountY - 1)) {
int newiconIndex=Math.min(widgetCount - 1,((y + 1) * cellCountX) + x);
parent.getChildAt(newiconIndex).requestFocus();
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_ENTER:
case KeyEvent.KEYCODE_DPAD_CENTER:
if (handleKeyEvent) {
View.OnClickListener clickListener=(View.OnClickListener)container;
clickListener.onClick(v);
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_PAGE_UP:
if (handleKeyEvent) {
if (pageIndex > 0) {
newParent=getPagedViewCellLayoutChildrenForIndex(container,pageIndex - 1);
if (newParent != null) {
child=newParent.getChildAt(0);
if (child != null) child.requestFocus();
}
}
 else {
parent.getChildAt(0).requestFocus();
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_PAGE_DOWN:
if (handleKeyEvent) {
if (pageIndex < (pageCount - 1)) {
newParent=getPagedViewCellLayoutChildrenForIndex(container,pageIndex + 1);
if (newParent != null) {
child=newParent.getChildAt(0);
if (child != null) child.requestFocus();
}
}
 else {
parent.getChildAt(widgetCount - 1).requestFocus();
}
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_MOVE_HOME:
if (handleKeyEvent) {
parent.getChildAt(0).requestFocus();
}
wasHandled=true;
break;
case KeyEvent.KEYCODE_MOVE_END:
if (handleKeyEvent) {
parent.getChildAt(widgetCount - 1).requestFocus();
}
wasHandled=true;
break;
default :
break;
}
return wasHandled;
}
