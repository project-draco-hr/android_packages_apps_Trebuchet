{
synchronized (sCanvas) {
    if (sIconWidth == -1) {
      initStatics(context);
    }
    int width=sIconWidth;
    int height=sIconHeight;
    float scale=1.0f;
    if (icon instanceof PaintDrawable) {
      PaintDrawable painter=(PaintDrawable)icon;
      painter.setIntrinsicWidth(width);
      painter.setIntrinsicHeight(height);
    }
 else     if (icon instanceof BitmapDrawable) {
      BitmapDrawable bitmapDrawable=(BitmapDrawable)icon;
      Bitmap bitmap=bitmapDrawable.getBitmap();
      if (bitmap.getDensity() == Bitmap.DENSITY_NONE) {
        bitmapDrawable.setTargetDensity(context.getResources().getDisplayMetrics());
      }
    }
    int iconWidth=icon.getIntrinsicWidth();
    int iconHeight=icon.getIntrinsicHeight();
    if (iconWidth > 0 && iconWidth > 0) {
      if (width < iconWidth || height < iconHeight || scale != 1.0f) {
        final float ratio=(float)iconWidth / iconHeight;
        if (iconWidth > iconHeight) {
          height=(int)(width / ratio);
        }
 else         if (iconHeight > iconWidth) {
          width=(int)(height * ratio);
        }
        final Bitmap.Config c=icon.getOpacity() != PixelFormat.OPAQUE ? Bitmap.Config.ARGB_8888 : Bitmap.Config.RGB_565;
        final Bitmap thumb=Bitmap.createBitmap(sIconWidth,sIconHeight,c);
        final Canvas canvas=sCanvas;
        canvas.setBitmap(thumb);
        sOldBounds.set(icon.getBounds());
        final int x=(sIconWidth - width) / 2;
        final int y=(sIconHeight - height) / 2;
        icon.setBounds(x,y,x + width,y + height);
        icon.draw(canvas);
        icon.setBounds(sOldBounds);
        icon=new FastBitmapDrawable(thumb);
      }
 else       if (iconWidth < width && iconHeight < height) {
        final Bitmap.Config c=Bitmap.Config.ARGB_8888;
        final Bitmap thumb=Bitmap.createBitmap(sIconWidth,sIconHeight,c);
        final Canvas canvas=sCanvas;
        canvas.setBitmap(thumb);
        sOldBounds.set(icon.getBounds());
        final int x=(width - iconWidth) / 2;
        final int y=(height - iconHeight) / 2;
        icon.setBounds(x,y,x + iconWidth,y + iconHeight);
        icon.draw(canvas);
        icon.setBounds(sOldBounds);
        icon=new FastBitmapDrawable(thumb);
      }
    }
    return icon;
  }
}
